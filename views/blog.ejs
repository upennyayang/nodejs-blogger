<% layout('layout') -%>

<div class="container md">

    <h1><span class="fa fa-book"></span> Blog</h1>

  <div class="panel">
    <div class="panel-body">
      <% for(var i = 0; i < posts.length; i ++) { %>
        <% var post = posts[i]; %>
        <h1 class="post-heading"><%= post.title %><a href="/blogger<%= post.username %>"></a></h1>


        <p class="post-date"><%= shortDate(post.releaseDate) %></p>
        <p class="post-author">Posted by <%= post.username %></p>
        <hr>

        <% if(post.image) { %>
          <img class="post-image" src="<%= post.image %>" />
        <% } else { %>
          <div class="well">No Image for This Post</div>
        <% } %>

        <p class="post-content"><%= post.content %></p>

        <hr>

        <h3> Leave a comment </h3>

        <!-- The user is not logged in -->
        <% if(!username) { %>
          <form action="/login-comment" method="post">
            <div class="form-group">
              <label>Username or Email</label>
              <input type="text" class="form-control" name="username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" class="form-control" name="password">
            </div>

        <!-- The user is already logged in -->
        <% } else { %>
          <form action="/comment" method="post">
            <input type="hidden" name="username" value="<%= username %>" />
        <% } %>

          <input type="hidden" name="postId" value="<%= post._id %>"></input>
          <label>Comment</label>
          <textarea rows="4" cols="50"type="text" class="form-control" name="comment"></textarea>
          <br>
          <button type="submit" class="btn btn-primary">
            <% if(!username) { %>Log in &<% } %> Post
          </button>
        </form>

        <hr>
        <!-- comments -->
        <ul class="media-list">
          <% for(var i = 0; i < post.comments.length; i ++) { %>

            <% var comment = post.comments[i]; %>
            <li class="media">
              <div class="media-left">
                <a href="#"><img src="http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=74" width="74" height="74" alt="" class="media-object pull-left img-circle" /></a>
              </div>
              <div class="media-body">
                <h4 class="media-heading"><%= comment.username %> &nbsp; <small> <%= shortDate(comment.date) %> </small></h4>
                <p><%= comment.text %></p>
              </div>
            </li>

          <% } %>
        </ul>

      <% } %> <!-- END posts loop -->
    </div><!-- END .panel-body -->
  </div><!-- END .panel -->

</div><!-- END .container -->


